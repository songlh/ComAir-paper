\begin{figure}
\centering
\scriptsize
\lstset{basicstyle=\ttfamily\selectfont,
     morekeywords={+},keepspaces=true,numbers=left}
  \mbox{\lstinputlisting[mathescape,boxpos=t]{figure/apache34464.c}}
  \vspace{-0.05in}
  \mycaption{fig:apache34464}{An Apache bug in $O(N^2)$ complexity and its patch.}
  {The execution cost scales polynomially as the number of chars from \texttt{getchar()}.}
%\caption{An Apache performance problem in $O(N^2)$ complexity and its patch. 
%\footnotesize{(This figure shows the buggy code fragment for Apache\#34464. 
% The execution time scales polynomially with the number of characters read from \texttt{getchar()}.)}}
%\vspace{-0.05in}
%\label{fig:apache34464}
\vspace{-3pt}
\end{figure}